
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Decision Analysis &#8212; Think Bayes</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Testing" href="chap10.html" />
    <link rel="prev" title="Poisson Processes" href="chap08.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Think Bayes</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Think Bayes 2
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="preface.html">
   Preface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap01.html">
   Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap02.html">
   Bayes’s Theorem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap03.html">
   Distributions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap04.html">
   Estimating Proportions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap05.html">
   Estimating counts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap06.html">
   Odds and Addends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap07.html">
   Minimum, maximum, and mixture
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap08.html">
   Poisson Processes
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Decision Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap10.html">
   Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap11.html">
   Comparison
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap12.html">
   Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap13.html">
   Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap14.html">
   Survival Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap15.html">
   Mark and Recapture
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap16.html">
   Logistic regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap17.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap18.html">
   Conjugate Priors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap19.html">
   MCMC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chap20.html">
   Approximate Bayesian Computation
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/chap09.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/AllenDowney/ThinkBayes2"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/AllenDowney/ThinkBayes2/master?urlpath=tree/chap09.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-price-is-right-problem">
   The Price is Right problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-prior">
   The prior
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#kernel-density-estimation">
   Kernel Density Estimation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distribution-of-error">
   Distribution of error
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#update">
   Update
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#probability-of-winning">
   Probability of winning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Decision analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#maximizing-expected-gain">
   Maximizing Expected Gain
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   Discussion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="decision-analysis">
<h1>Decision Analysis<a class="headerlink" href="#decision-analysis" title="Permalink to this headline">¶</a></h1>
<p>This chapter presents a problem inspired by the game show <em>The Price is Right</em>.
It is a silly example, but it demonstrates a useful process called Bayesian <a class="reference external" href="https://en.wikipedia.org/wiki/Decision_analysis">decision analysis</a>.</p>
<p>As in previous examples, we’ll use data and prior distribution to compute a posterior distribution; then we’ll use the posterior distribution to choose an optimal strategy in a game that involves bidding.</p>
<p>As part of the solution, we will use kernel density estimation (KDE) to estimate the prior distribution, and a normal distribution to compute the likelihood of the data.</p>
<p>And at the end of the chapter, I pose a related problem you can solve as an exercise.</p>
<div class="section" id="the-price-is-right-problem">
<h2>The Price is Right problem<a class="headerlink" href="#the-price-is-right-problem" title="Permalink to this headline">¶</a></h2>
<p>On November 1, 2007, contestants named Letia and Nathaniel appeared on <em>The Price is Right</em>, an American television game show. They competed in a game called “The Showcase”, where the objective is to guess the price of a collection of prizes. The contestant who comes closest to the actual price, without going over, wins the prizes.</p>
<p>Nathaniel went first. His showcase included a dishwasher, a wine cabinet, a laptop computer, and a car. He bid \$26,000.</p>
<p>Letia’s showcase included a pinball machine, a video arcade game, a pool table, and a cruise of the Bahamas. She bid \$21,500.</p>
<p>The actual price of Nathaniel’s showcase was \$25,347. His bid was too high, so he lost.</p>
<p>The actual price of Letia’s showcase was \$21,578.</p>
<p>She was only off by \$78, so she won her showcase and, because her bid was off by less than 250, she also won Nathaniel’s showcase.</p>
<p>For a Bayesian thinker, this scenario suggests several questions:</p>
<ol class="simple">
<li><p>Before seeing the prizes, what prior beliefs should the contestants have about the price of the showcase?</p></li>
<li><p>After seeing the prizes, how should the contestants update those beliefs?</p></li>
<li><p>Based on the posterior distribution, what should the contestants bid?</p></li>
</ol>
<p>The third question demonstrates a common use of Bayesian methods: decision analysis.</p>
<p>This problem is inspired by <a class="reference external" href="https://nbviewer.jupyter.org/github/CamDavidsonPilon/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers/blob/master/Chapter5_LossFunctions/Ch5_LossFunctions_PyMC3.ipynb">an example</a> in Cameron Davidson-Pilon’s book, <a class="reference external" href="http://camdavidsonpilon.github.io/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers">Probablistic Programming and Bayesian Methods for Hackers</a>.</p>
</div>
<div class="section" id="the-prior">
<h2>The prior<a class="headerlink" href="#the-prior" title="Permalink to this headline">¶</a></h2>
<p>To choose a prior distribution of prices, we can take advantage of data from previous episodes. Fortunately, <a class="reference external" href="https://web.archive.org/web/20121107204942/http://www.tpirsummaries.8m.com/">fans of the show keep detailed records</a>.</p>
<p>For this example, I downloaded files containing the price of each showcase from the 2011 and 2012 seasons and the bids offered by the contestants.</p>
<p>The following function reads the data and cleans it up a little.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read the showcase price data.&quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>I’ll read both files and concatenate them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df2011</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;showcases.2011.csv&#39;</span><span class="p">)</span>
<span class="n">df2012</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="s1">&#39;showcases.2012.csv&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df2011</span><span class="p">,</span> <span class="n">df2012</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df2011</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df2012</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(191, 6) (122, 6) (313, 6)
</pre></div>
</div>
</div>
</div>
<p>Here’s what the dataset looks like:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Showcase 1</th>
      <th>Showcase 2</th>
      <th>Bid 1</th>
      <th>Bid 2</th>
      <th>Difference 1</th>
      <th>Difference 2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>50969.0</td>
      <td>45429.0</td>
      <td>42000.0</td>
      <td>34000.0</td>
      <td>8969.0</td>
      <td>11429.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>21901.0</td>
      <td>34061.0</td>
      <td>14000.0</td>
      <td>59900.0</td>
      <td>7901.0</td>
      <td>-25839.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>32815.0</td>
      <td>53186.0</td>
      <td>32000.0</td>
      <td>45000.0</td>
      <td>815.0</td>
      <td>8186.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The first two columns, <code class="docutils literal notranslate"><span class="pre">Showcase</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">Showcase</span> <span class="pre">2</span></code>, are the values of the showcases in dollars.
The next two columns are the bids the contestants made.
The last two columns are the differences between the actual values and the bids.</p>
</div>
<div class="section" id="kernel-density-estimation">
<h2>Kernel Density Estimation<a class="headerlink" href="#kernel-density-estimation" title="Permalink to this headline">¶</a></h2>
<p>This dataset contains the prices for 313 previous showcases, which we can think of as a sample from the population of possible prices.</p>
<p>We can use this sample to estimate the prior distribution of showcase prices.  One way to do that is kernel density estimation (KDE), which uses the sample to estimate a smooth distribution.  If you are not familiar with KDE, you can <a class="reference external" href="https://mathisonian.github.io/kde">read about it here</a>.</p>
<p>SciPy provides <code class="docutils literal notranslate"><span class="pre">gaussian_kde</span></code>, which takes a sample and returns an object that represents the estimated distribution.</p>
<p>The following function takes <code class="docutils literal notranslate"><span class="pre">sample</span></code>, makes a KDE, evaluates it at a given sequence of quantities, <code class="docutils literal notranslate"><span class="pre">qs</span></code>, and returns the result as a normalized PMF.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Pmf</span>

<span class="k">def</span> <span class="nf">kde_from_sample</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">qs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Make a kernel density estimate from a sample.&quot;&quot;&quot;</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
    <span class="n">pmf</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">pmf</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pmf</span>
</pre></div>
</div>
</div>
</div>
<p>We can use it to estimate the distribution of values for Showcase 1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">81</span><span class="p">)</span>
<span class="n">prior1</span> <span class="o">=</span> <span class="n">kde_from_sample</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 1&#39;</span><span class="p">],</span> <span class="n">qs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what it looks like:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">decorate</span>

<span class="k">def</span> <span class="nf">decorate_value</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Showcase value ($)&#39;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;PMF&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 1&#39;</span><span class="p">)</span>
<span class="n">decorate_value</span><span class="p">(</span><span class="s1">&#39;Prior distribution of showcase value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_25_0.png" src="_images/chap09_25_0.png" />
</div>
</div>
<p><strong>Exercise:</strong> Use this function to make a <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> that represents the prior distribution for Showcase 2, and plot it.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">80000</span><span class="p">,</span> <span class="mi">81</span><span class="p">)</span>
<span class="n">prior2</span> <span class="o">=</span> <span class="n">kde_from_sample</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 2&#39;</span><span class="p">],</span> <span class="n">qs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 1&#39;</span><span class="p">)</span>
<span class="n">prior2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 2&#39;</span><span class="p">)</span>

<span class="n">decorate_value</span><span class="p">(</span><span class="s1">&#39;Prior distributions of showcase value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_28_0.png" src="_images/chap09_28_0.png" />
</div>
</div>
</div>
<div class="section" id="distribution-of-error">
<h2>Distribution of error<a class="headerlink" href="#distribution-of-error" title="Permalink to this headline">¶</a></h2>
<p>To update these priors, we have to answer these questions:</p>
<ul class="simple">
<li><p>What data should we consider and how should we quantify it?</p></li>
<li><p>Can we compute a likelihood function; that is, for each hypothetical price, can we compute the conditional likelihood of the data?</p></li>
</ul>
<p>To answer these questions, I will model each contestant as a price-guessing instrument with known error characteristics.
In this model, when the contestant sees the prizes, they guess the price of each prize and add up the prices.
Let’s call this total <code class="docutils literal notranslate"><span class="pre">guess</span></code>.</p>
<p>Now the question we have to answer is, “If the actual price is <code class="docutils literal notranslate"><span class="pre">price</span></code>, what is the likelihood that the contestant’s guess would be <code class="docutils literal notranslate"><span class="pre">guess</span></code>?”</p>
<p>Equivalently, if we define <code class="docutils literal notranslate"><span class="pre">error</span> <span class="pre">=</span> <span class="pre">guess</span> <span class="pre">-</span> <span class="pre">price</span></code>, we can ask, “What is the likelihood that the contestant’s guess is off by <code class="docutils literal notranslate"><span class="pre">error</span></code>?”</p>
<p>To answer this question, I’ll use the historical data again.
For each showcase in the dataset, let’s look at the difference between the contestant’s bid and the actual price:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_diff1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Bid 1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 1&#39;</span><span class="p">]</span>
<span class="n">sample_diff2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Bid 2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Showcase 2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>To visualize the distribution of these differences, we can use KDE again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">40000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">61</span><span class="p">)</span>
<span class="n">kde_diff1</span> <span class="o">=</span> <span class="n">kde_from_sample</span><span class="p">(</span><span class="n">sample_diff1</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">kde_diff2</span> <span class="o">=</span> <span class="n">kde_from_sample</span><span class="p">(</span><span class="n">sample_diff2</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what these distributions look like:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kde_diff1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Diff 1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C8&#39;</span><span class="p">)</span>
<span class="n">kde_diff2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Diff 2&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C4&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Difference in value ($)&#39;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;PMF&#39;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Difference between bid and actual value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_34_0.png" src="_images/chap09_34_0.png" />
</div>
</div>
<p>It looks like the bids are too low more often than too high, which makes sense.  Remember that under the rules of the game, you lose if you overbid, so contestants probably underbid to some degree deliberately.</p>
<p>For example, if they guess that the value of the showcase is \<span class="math notranslate nohighlight">\(40,000, they might bid \\\)</span>36,000 to avoid going over.</p>
<p>It looks like these distributions are well modeled by a normal distribution, so we can summarize them with their mean and standard deviation.</p>
<p>For example, here is the mean and standard deviation of <code class="docutils literal notranslate"><span class="pre">Diff</span></code> for Player 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_diff1</span> <span class="o">=</span> <span class="n">sample_diff1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_diff1</span> <span class="o">=</span> <span class="n">sample_diff1</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mean_diff1</span><span class="p">,</span> <span class="n">std_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-4116.3961661341855 6899.909806377117
</pre></div>
</div>
</div>
</div>
<p>Now we can use these differences to model the contestant’s distribution of errors.
This step is a little tricky because we don’t actually know the contestant’s guesses; we only know what they bid.</p>
<p>So we have to make some assumptions:</p>
<ul class="simple">
<li><p>I’ll assume that contestants underbid because they are being strategic, and that on average their guesses are accurate.  In other words, the mean of their errors is 0.</p></li>
<li><p>But I’ll assume that the spread of the differences reflects the actual spread of their errors.  So, I’ll use the standard deviation of the differences as the standard deviation of their errors.</p></li>
</ul>
<p>Based on these assumptions, I’ll make a normal distribution with parameters 0 and <code class="docutils literal notranslate"><span class="pre">std_diff1</span></code>.</p>
<p>SciPy provides an object called <code class="docutils literal notranslate"><span class="pre">norm</span></code> that represents a normal distribution with the given mean and standard deviation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="n">error_dist1</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is an object that provides <code class="docutils literal notranslate"><span class="pre">pdf</span></code>, which evaluates the probability density function of the normal distribution.</p>
<p>For example, here is the probability density of <code class="docutils literal notranslate"><span class="pre">error=-100</span></code>, based on the distribution of errors for Player 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
<span class="n">error_dist1</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.781240564008691e-05
</pre></div>
</div>
</div>
</div>
<p>By itself, this number doesn’t mean very much, because probability densities are not probabilities. But they are proportional to probabilities, so we can use them as likelihoods in a Bayesian update, as we’ll see in the next section.</p>
</div>
<div class="section" id="update">
<h2>Update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h2>
<p>Suppose you are Player 1.  You see the prizes in your showcase and your guess for the total price is \$23,000.</p>
<p>From your guess I will subtract away each hypothetical price in the prior distribution; the result is your error under each hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">guess1</span> <span class="o">=</span> <span class="mi">23000</span>
<span class="n">error1</span> <span class="o">=</span> <span class="n">guess1</span> <span class="o">-</span> <span class="n">prior1</span><span class="o">.</span><span class="n">qs</span>
</pre></div>
</div>
</div>
</div>
<p>Now suppose we know, based on past performance, that your estimation error is well modeled by <code class="docutils literal notranslate"><span class="pre">error_dist1</span></code>.
Under that assumption we can compute the likelihood of your error under each hypothesis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">likelihood1</span> <span class="o">=</span> <span class="n">error_dist1</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">error1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is an array of likelihoods, which we can use to update the prior.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posterior1</span> <span class="o">=</span> <span class="n">prior1</span> <span class="o">*</span> <span class="n">likelihood1</span>
<span class="n">posterior1</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.3889812097254624e-05
</pre></div>
</div>
</div>
</div>
<p>Here’s what the posterior distribution looks like:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C5&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 1&#39;</span><span class="p">)</span>
<span class="n">posterior1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C4&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior 1&#39;</span><span class="p">)</span>

<span class="n">decorate_value</span><span class="p">(</span><span class="s1">&#39;Prior and posterior distribution of showcase value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_50_0.png" src="_images/chap09_50_0.png" />
</div>
</div>
<p>Because your initial guess is in the lower end of the range, the posterior distribution has shifted to the left.  We can compute the posterior mean to see by how much.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prior1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(30299.488817891375, 12.000000007076508)
</pre></div>
</div>
</div>
</div>
<p>Before you saw the prizes, you expected to see a showcase with a value close to \<span class="math notranslate nohighlight">\(30,000.
After making a guess of \\\)</span>23,000, you updated the prior distribution.
Based on the combination of the prior and your guess, you now expect the actual price to be about \$26,000.</p>
<p><strong>Exercise:</strong> Now suppose you are Player 2.  When you see your showcase, you guess that the total price is \$38,000.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">diff2</span></code> to construct a normal distribution that represents the distribution of your estimation errors.</p>
<p>Compute the likelihood of your guess for each actual price and use it to update <code class="docutils literal notranslate"><span class="pre">prior2</span></code>.</p>
<p>Plot the posterior distribution and compute the posterior mean.  Based on the prior and your guess, what do you expect the actual price of the showcase to be?</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">mean_diff2</span> <span class="o">=</span> <span class="n">sample_diff2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std_diff2</span> <span class="o">=</span> <span class="n">sample_diff2</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mean_diff2</span><span class="p">,</span> <span class="n">std_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-3675.891373801917 6886.260711323408
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">error_dist2</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">std_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">guess2</span> <span class="o">=</span> <span class="mi">38000</span>
<span class="n">error2</span> <span class="o">=</span> <span class="n">guess2</span> <span class="o">-</span> <span class="n">prior2</span><span class="o">.</span><span class="n">qs</span>

<span class="n">likelihood2</span> <span class="o">=</span> <span class="n">error_dist2</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">error2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">posterior2</span> <span class="o">=</span> <span class="n">prior2</span> <span class="o">*</span> <span class="n">likelihood2</span>
<span class="n">posterior2</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.697812321910702e-05
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prior2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C5&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prior 2&#39;</span><span class="p">)</span>
<span class="n">posterior2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C15&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior 2&#39;</span><span class="p">)</span>

<span class="n">decorate_value</span><span class="p">(</span><span class="s1">&#39;Prior and posterior distribution of showcase value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_59_0.png" src="_images/chap09_59_0.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prior2</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>31047.623719122505 34305.20161642469
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="probability-of-winning">
<h2>Probability of winning<a class="headerlink" href="#probability-of-winning" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a posterior distribution for each player, let’s think about strategy.</p>
<p>First, from the point of view of Player 1, let’s compute the probability that Player 2 overbids.  To keep it simple, I’ll use only the performance of past players, ignoring the value of the showcase.</p>
<p>The following function takes a sequence of past bids and returns the fraction that overbid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prob_overbid</span><span class="p">(</span><span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the probability of an overbid.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample_diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s an estimate for the probability that Player 2 overbids.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_overbid</span><span class="p">(</span><span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.29073482428115016
</pre></div>
</div>
</div>
</div>
<p>Now suppose Player 1 underbids by \$5000.
What is the probability that Player 2 underbids by more?</p>
<p>The following function uses past performance to estimate the probability that a player underbids by more than a given amount, <code class="docutils literal notranslate"><span class="pre">diff</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prob_worse_than</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Probability opponent diff is worse than given diff.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample_diff</span> <span class="o">&lt;</span> <span class="n">diff</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the probability that Player 2 underbids by more than \$5000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_worse_than</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.38338658146964855
</pre></div>
</div>
</div>
</div>
<p>And here’s the probability they underbid by more than \$10,000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_worse_than</span><span class="p">(</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.14376996805111822
</pre></div>
</div>
</div>
</div>
<p>We can combine these functions to compute the probability that Player 1 wins, given the difference between their bid and the actual price:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_prob_win</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Probability of winning for a given diff.&quot;&quot;&quot;</span>
    <span class="c1"># if you overbid you lose</span>
    <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="c1"># if the opponent overbids, you win</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">prob_overbid</span><span class="p">(</span><span class="n">sample_diff</span><span class="p">)</span>
    
    <span class="c1"># or of their bid is worse than yours, you win</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">prob_worse_than</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>
    
    <span class="c1"># p1 and p2 are mutually exclusive, so we can add them</span>
    <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the probability that you win, given that you underbid by \$5000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_prob_win</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6741214057507987
</pre></div>
</div>
</div>
</div>
<p>Now let’s look at the probability of winning for a range of possible differences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_prob_win</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span> 
      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s what it looks like:</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Difference between bid and actual price ($)&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Player 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_78_0.png" src="_images/chap09_78_0.png" />
</div>
</div>
<p>If you underbid by \$30,000, the chance of winning is about 30%, which is mostly the chance your opponent overbids.</p>
<p>As your bids gets closer to the actual price, your chance of winning approaches 1.</p>
<p>And, of course, if you overbid, you lose (even if your opponent also overbids).</p>
<p><strong>Exercise:</strong> Run the same analysis from the point of view of Player 2.  Using the sample of differences from Player 1, compute:</p>
<ol class="simple">
<li><p>The probability that Player 1 overbids.</p></li>
<li><p>The probability that Player 1 underbids by more than \$5000.</p></li>
<li><p>The probability that Player 2 wins, given that they underbid by \$5000.</p></li>
</ol>
<p>Then plot the probability that Player 2 wins for a range of possible differences between their bid and the actual price.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_overbid</span><span class="p">(</span><span class="n">sample_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.24600638977635783
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_worse_than</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3993610223642173
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">compute_prob_win</span><span class="p">(</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6453674121405751
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_prob_win</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Difference between bid and actual price ($)&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Player 2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_85_0.png" src="_images/chap09_85_0.png" />
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Decision analysis<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>In the previous section we computed the probability of winning, given that we have underbid by a particular amount.</p>
<p>In reality the contestants don’t know how much they have underbid by, because they don’t know the actual price.</p>
<p>But they do have a posterior distribution that represents their beliefs about the actual price, and they can use that to estimate their probability of winning with a given bid.</p>
<p>The following function takes a possible bid, a posterior distribution of actual prices, and a sample of differences for the opponent.</p>
<p>It loops through the hypothetical prices in the posterior distribution and, for each price,</p>
<ol class="simple">
<li><p>Computes the difference between the bid and the hypothetical price,</p></li>
<li><p>Computes the probability that the player wins, given that difference, and</p></li>
<li><p>Adds up the weighted sum of the probabilities, where the weights are the probabilities in the posterior distribution.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">total_prob_win</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes the total probability of winning with a given bid.</span>

<span class="sd">    bid: your bid</span>
<span class="sd">    posterior: Pmf of showcase value</span>
<span class="sd">    sample_diff: sequence of differences for the opponent</span>
<span class="sd">    </span>
<span class="sd">    returns: probability of winning</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">price</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">posterior</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">bid</span> <span class="o">-</span> <span class="n">price</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">compute_prob_win</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
</div>
</div>
<p>This loop implements the law of total probability:</p>
<div class="math notranslate nohighlight">
\[P(win) = \sum_{price} P(price) ~ P(win ~|~ price)\]</div>
<p>Here’s the probability that Player 1 wins, based on a bid of \$25,000 and the posterior distribution <code class="docutils literal notranslate"><span class="pre">posterior1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_prob_win</span><span class="p">(</span><span class="mi">25000</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4842210945439812
</pre></div>
</div>
</div>
</div>
<p>Now we can loop through a series of possible bids and compute the probability of winning for each one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bids</span> <span class="o">=</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">qs</span>

<span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_prob_win</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">prob_win_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the results.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_win_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Player 1&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_93_0.png" src="_images/chap09_93_0.png" />
</div>
</div>
<p>And here’s the bid that maximizes Player 1’s chance of winning.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_win_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>21000.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prob_win_series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6136807192359474
</pre></div>
</div>
</div>
</div>
<p>Recall that your guess was \<span class="math notranslate nohighlight">\(23,000.
Using your guess to compute the posterior distribution, the posterior mean is about \\\)</span>26,000.
But the bid that maximizes your chance of winning is \$21,000.</p>
<p><strong>Exercise:</strong> Do the same analysis for Player 2.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">bids</span> <span class="o">=</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">qs</span>

<span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_prob_win</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior2</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span> 
         <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">prob_win_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_win_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Player 2&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Probability of winning&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_100_0.png" src="_images/chap09_100_0.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_win_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>29000.0
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prob_win_series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5171370053364229
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="maximizing-expected-gain">
<h2>Maximizing Expected Gain<a class="headerlink" href="#maximizing-expected-gain" title="Permalink to this headline">¶</a></h2>
<p>In the previous section we computed the bid that maximizes your chance of winning.
And if that’s your goal, the bid we computed is optimal.</p>
<p>But winning isn’t everything.
Remember that if your bid is off by \$250 or less, you win both showcases.
So it might be a good idea to increase your bid a little: it increases the chance you overbid and lose, but it also increases the chance of winning both showcases.</p>
<p>Let’s see how that works out.
The following function computes how much you will win, on average, given your bid, the actual price, and a sample of errors for your opponent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute expected gain given a bid and actual price.&quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">bid</span> <span class="o">-</span> <span class="n">price</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="n">compute_prob_win</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>

    <span class="c1"># if you are within 250 dollars, you win both showcases</span>
    <span class="k">if</span> <span class="o">-</span><span class="mi">250</span> <span class="o">&lt;=</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">price</span> <span class="o">*</span> <span class="n">prob</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">price</span> <span class="o">*</span> <span class="n">prob</span>
</pre></div>
</div>
</div>
</div>
<p>For example, if the actual price is \<span class="math notranslate nohighlight">\(35000 
and you bid \\\)</span>30000,
you will win about \$23,600 worth of prizes on average, taking into account your probability of losing, winning one showcase, or winning both.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_gain</span><span class="p">(</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">35000</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>23594.249201277955
</pre></div>
</div>
</div>
</div>
<p>In reality we don’t know the actual price, but we have a posterior distribution that represents what we know about it.
By averaging over the prices and probabilities in the posterior distribution, we can compute the expected gain for a particular bid.</p>
<p>In this context, “expected” means the average over the possible showcase values, weighted by their probabilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">expected_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the expected gain of a given bid.&quot;&quot;&quot;</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">price</span><span class="p">,</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">posterior</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">prob</span> <span class="o">*</span> <span class="n">compute_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">sample_diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>
</pre></div>
</div>
</div>
</div>
<p>For the posterior we computed earlier, based on a guess of \<span class="math notranslate nohighlight">\(23,000, the expected gain for a bid of \\\)</span>21,000 is about \$16,900.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain</span><span class="p">(</span><span class="mi">21000</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16923.59933856512
</pre></div>
</div>
</div>
</div>
<p>But can we do any better?</p>
<p>To find out, we can loop through a range of bids and find the one that maximizes expected gain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bids</span> <span class="o">=</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">qs</span>

<span class="n">gains</span> <span class="o">=</span> <span class="p">[</span><span class="n">expected_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior1</span><span class="p">,</span> <span class="n">sample_diff2</span><span class="p">)</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">expected_gain_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">gains</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here are the results.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Expected gain ($)&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Player 1&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_114_0.png" src="_images/chap09_114_0.png" />
</div>
</div>
<p>Here is the optimal bid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22000.0
</pre></div>
</div>
</div>
</div>
<p>With that bid, the expected gain is about \$17,400.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_gain_series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17384.899584430797
</pre></div>
</div>
</div>
</div>
<p>Recall that your initial guess was \<span class="math notranslate nohighlight">\(23,000.
The bid that maximizes the chance of winning is \\\)</span>21,000.
And the bid that maximizes your expected gain is \$22,000.</p>
<p><strong>Exercise:</strong> Do the same analysis for Player 2.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">bids</span> <span class="o">=</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">qs</span>

<span class="n">gains</span> <span class="o">=</span> <span class="p">[</span><span class="n">expected_gain</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">posterior2</span><span class="p">,</span> <span class="n">sample_diff1</span><span class="p">)</span> <span class="k">for</span> <span class="n">bid</span> <span class="ow">in</span> <span class="n">bids</span><span class="p">]</span>

<span class="n">expected_gain_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">gains</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">bids</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">expected_gain_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Bid ($)&#39;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Expected gain ($)&#39;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Player 2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_122_0.png" src="_images/chap09_122_0.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">expected_gain_series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30000.0
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">expected_gain_series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19404.164188501607
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>There’s a lot going on this this chapter, so let’s review the steps:</p>
<ol class="simple">
<li><p>First we used KDE and data from past shows to estimate prior distributions for the values of the showcases.</p></li>
<li><p>Then we used bids from past shows to model the distribution of errors as a normal distribution.</p></li>
<li><p>We did a Bayesian update using the distribution of errors to compute the likelihood of the data.</p></li>
<li><p>We used the posterior distribution for the value of the showcase to compute the probability of winning for each possible bid, and identified the bid that maximizes the chance of winning.</p></li>
<li><p>Finally, we used probability of winning to compute the expected gain for each possible bid, and identified the bid that maximizes expected gain.</p></li>
</ol>
<p>Incidentally, this example demonstrates the hazard of using the word “optimal” without specifying what you are optimizing.
The bid that maximizes the chance of winning is not generally the same as the bid that maximizes expected gain.</p>
</div>
<div class="section" id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<p>When people discuss the pros and cons of Bayesian estimation, as contrasted with classical methods sometimes called “frequentist”, they often claim that in many cases Bayesian methods and frequentist methods produce the same results.</p>
<p>In my opinion, this claim is mistaken because Bayesian and frequentist method produce different <em>kinds</em> of results:</p>
<ul class="simple">
<li><p>The result of frequentist methods is usually a single value that is considered to be the best estimate (by one of several criteria) or an interval that quantifies the precision of the estimate.</p></li>
<li><p>The result of Bayesian methods is a posterior distribution that represents all possible outcomes and their probabilities.</p></li>
</ul>
<p>Granted, you can use the posterior distribution to choose a “best” estimate or compute an interval.
And in that case the result might be the same as the frequentist estimate.</p>
<p>But doing so discards useful information and, in my opinion, eliminates the primary benefit of Bayesian methods: the posterior distribution is more useful than a single estimate, or even an interval.</p>
<p>The example in this chapter demonstrates the point.
Using the entire posterior distribution, we can compute the bid that maximizes the probability of winning, or the bid that maximizes expected gain, even if the rules for computing the gain are complicated (and nonlinear).</p>
<p>With a single estimate or an interval, we can’t do that, even if they are “optimal” in some sense.
In general, frequentist estimation provides little guidance for decision-making.</p>
<p>If you hear someone say that Bayesian and frequentist methods produce the same results, you can be confident that they don’t understand Bayesian methods.</p>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p><strong>Exercise:</strong>  This exercise is inspired by a true story.  In 2001 I created <a class="reference external" href="https://greenteapress.com">Green Tea Press</a> to publish my books, starting with <em>Think Python</em>.  I ordered 100 copies from a short run printer and made the book available for sale through a distributor.</p>
<p>After the first week, the distributor reported that 12 copies were sold.  Based that report, I thought I would run out of copies in about 8 weeks, so I got ready to order more.  My printer offered me a discount if I ordered more than 1000 copies, so I went a little crazy and ordered 2000.</p>
<p>A few days later, my mother called to tell me that her <em>copies</em> of the book had arrived.  Surprised, I asked how many.  She said ten.</p>
<p>It turned out I had sold only two books to non-relatives.  And it took a lot longer than I expected to sell 2000 copies.</p>
<p>The details of this story are unique, but the general problem is something almost every retailer has to figure out.  Based on past sales, how do you predict future sales?  And based on those predictions, how do you decide how much to order and when?</p>
<p>Often the cost of a bad decision is complicated.  If you place a lot of small orders rather than one big one, your costs are likely to be higher.  If you run out of inventory, you might lose customers.  And if you order too much, you have to pay the various costs of holding inventory.</p>
<p>So, let’s solve a version of the problem I faced.  It will take some work to set up the problem; the details are in the notebook for this chapter.</p>
<p>Suppose you start selling books online.  During the first week you sell 12 copies (and let’s assume that none of the customers are your mother).  During the second week you sell 8 copies.</p>
<p>Assuming that the arrival of orders is a Poisson process, we can think of the weekly orders as samples from a Poisson distribution with an unknown rate.</p>
<p>Choose a prior you think is appropriate and use the data to compute the posterior distribution of the order rate.
Then generate a posterior predictive distribution for the number of copies you expect during the next 8 weeks.</p>
<ul class="simple">
<li><p>Suppose the cost of printing the book is \$5 per copy,</p></li>
<li><p>But if you order 100 or more, it’s \$4.50 per copy.</p></li>
<li><p>For every book you sell, you get \$10.</p></li>
<li><p>But if you run out of books before the end of 8 weeks, you lose \$50 in future sales for every week you are out of stock.</p></li>
<li><p>If you have books left over at the end of 8 weeks, you lose \$2 in inventory costs per extra book.</p></li>
</ul>
<p>For example, suppose you get orders for 10 books per week, every week.</p>
<p>If you order 60 books,</p>
<ul class="simple">
<li><p>The total cost is \$300.</p></li>
<li><p>You sell all 30 books, so you make \$600.</p></li>
<li><p>But the book is out of stock for two weeks, so you lose \$100 in future sales.</p></li>
</ul>
<p>In total, your profit is \$200.</p>
<p>If you order 100 books,</p>
<ul class="simple">
<li><p>The total cost is \$450.</p></li>
<li><p>You sell 80 books, again, so you make \$800.</p></li>
<li><p>But you have 20 books left over at the end, so you lose \$40.</p></li>
</ul>
<p>In total, your profit is \$310.</p>
<p>Combining these costs with your predictive distribution, how many books should you order to maximize your expected profit?</p>
<p>To get you started, the following functions compute profits and costs according to the specification of the problem:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_cost</span><span class="p">(</span><span class="n">printed</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute print costs.</span>
<span class="sd">    </span>
<span class="sd">    printed: integer number printed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">printed</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">printed</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">printed</span> <span class="o">*</span> <span class="mf">4.5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">total_income</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute income.</span>
<span class="sd">    </span>
<span class="sd">    printed: integer number printed</span>
<span class="sd">    orders: sequence of integer number of books ordered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sold</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">orders</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sold</span> <span class="o">*</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">inventory_cost</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute inventory costs.</span>
<span class="sd">    </span>
<span class="sd">    printed: integer number printed</span>
<span class="sd">    orders: sequence of integer number of books ordered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">excess</span> <span class="o">=</span> <span class="n">printed</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">excess</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">excess</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">out_of_stock_cost</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute out of stock costs.</span>
<span class="sd">    </span>
<span class="sd">    printed: integer number printed</span>
<span class="sd">    orders: sequence of integer number of books ordered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weeks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
    <span class="n">total_orders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">total</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">total_orders</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="n">printed</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">weeks</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="mi">50</span>
    <span class="k">return</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_profit</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute profit.</span>
<span class="sd">    </span>
<span class="sd">    printed: integer number printed</span>
<span class="sd">    orders: sequence of integer number of books ordered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">total_income</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">print_cost</span><span class="p">(</span><span class="n">printed</span><span class="p">)</span><span class="o">-</span>
            <span class="n">out_of_stock_cost</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">inventory_cost</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To test these function, suppose we get exactly 10 orders per week for eight weeks:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">always_10</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">always_10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[10, 10, 10, 10, 10, 10, 10, 10]
</pre></div>
</div>
</div>
</div>
<p>If you print 60 books, your net profit is \$200, as in the example.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_profit</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="n">always_10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>200
</pre></div>
</div>
</div>
</div>
<p>If you print 100 books, your net profit is \$310.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_profit</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">always_10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>310.0
</pre></div>
</div>
</div>
</div>
<p>Of course, in the context of the problem you don’t know how many books will be ordered in any given week.  You don’t even know the average rate of orders.  However, given the data and some assumptions about the prior, you can compute the distribution of the rate of orders.</p>
<p>You’ll have a chance to do that, but to demonstrate the decision analysis part of the problem, I’ll start with the arbitrary assumption that order rates come from a gamma distribution with mean 10.</p>
<p>Here’s a <code class="docutils literal notranslate"><span class="pre">Pmf</span></code> that represents this distribution.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gamma</span>

<span class="n">alpha</span> <span class="o">=</span> <span class="mf">9.25</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">pmf</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">pmf</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">pmf</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.248417222248532
</pre></div>
</div>
</div>
</div>
<p>And here’s what it looks like:</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Book ordering rate ($\lambda$)&#39;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;PMF&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_147_0.png" src="_images/chap09_147_0.png" />
</div>
</div>
<p>Now, we <em>could</em> generate a predictive distribution for the number of books ordered in a given week, but in this example we have to deal with a complicated cost function.  In particular, <code class="docutils literal notranslate"><span class="pre">out_of_stock_cost</span></code> depends on the sequence of orders.</p>
<p>So, rather than generate a predictive distribution, I suggest we run simulations.  I’ll demonstrate the steps.</p>
<p>First, from our hypothetical distribution of rates, we can draw a random sample of 1000 values.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rates</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.2915
</pre></div>
</div>
</div>
</div>
<p>For each possible rate, we can generate a sequence of 8 orders.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">order_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">order_array</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 8,  8,  6, 11,  9,  9,  9,  9],
       [ 6,  4, 12, 12, 11, 12, 11, 11],
       [ 9,  7, 12, 14,  9, 12, 12,  7],
       [15,  9, 16, 11, 12, 10,  6, 10],
       [14, 20, 16, 13, 11, 10,  9, 16]])
</pre></div>
</div>
</div>
</div>
<p>Each row of this array is a hypothetical sequence of orders based on a different hypothetical order rate.</p>
<p>Now, if you tell me how many books you printed, I can compute your expected profits, averaged over these 1000 possible sequences.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_expected_profits</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">order_array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute profits averaged over a sample of orders.</span>
<span class="sd">    </span>
<span class="sd">    printed: number printed</span>
<span class="sd">    order_array: one row per sample, one column per week</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">profits</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_profit</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">orders</span><span class="p">)</span>
               <span class="k">for</span> <span class="n">orders</span> <span class="ow">in</span> <span class="n">order_array</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">profits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>For example, here are the expected profits if you order 70, 80, or 90 books.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_expected_profits</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="n">order_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>190.54
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_expected_profits</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="n">order_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>196.752
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_expected_profits</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="n">order_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>178.972
</pre></div>
</div>
</div>
</div>
<p>Now, let’s sweep through a range of values and compute expected profits as a function of the number of books you print.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">printed_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">110</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_expected_profits</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">order_array</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">printed</span> <span class="ow">in</span> <span class="n">printed_array</span><span class="p">]</span>
<span class="n">expected_profits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">printed_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_profits</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of books printed&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Expected profit ($)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_160_0.png" src="_images/chap09_160_0.png" />
</div>
</div>
<p>Here is the optimal order and the expected profit.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expected_profits</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">expected_profits</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(78, 197.08)
</pre></div>
</div>
</div>
</div>
<p>Now it’s your turn.  Choose a prior that you think is reasonable, update it with the data you are given, and then use the posterior distribution to do the analysis I just demonstrated.</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># For a prior I chose a log-uniform distribution; </span>
<span class="c1"># that is, a distribution that is uniform in log-space</span>
<span class="c1"># from 1 to 100 books per week.</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">prior</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>101
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># Here&#39;s the CDF of the prior</span>

<span class="n">prior</span><span class="o">.</span><span class="n">make_cdf</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Book ordering rate ($\lambda$)&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;CDF&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_165_0.png" src="_images/chap09_165_0.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># Here&#39;s a function that updates the distribution of lambda</span>
<span class="c1"># based on one week of orders</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">poisson</span>

<span class="k">def</span> <span class="nf">update_book</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update book ordering rate.</span>
<span class="sd">    </span>
<span class="sd">    pmf: Pmf of book ordering rates</span>
<span class="sd">    data: observed number of orders in one week</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">lams</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">index</span>
    <span class="n">likelihood</span> <span class="o">=</span> <span class="n">poisson</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">lams</span><span class="p">)</span>
    <span class="n">pmf</span> <span class="o">*=</span> <span class="n">likelihood</span>
    <span class="n">pmf</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># Here&#39;s the update after week 1.</span>

<span class="n">posterior1</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">update_book</span><span class="p">(</span><span class="n">posterior1</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># And the update after week 2.</span>

<span class="n">posterior2</span> <span class="o">=</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">update_book</span><span class="p">(</span><span class="n">posterior2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="n">prior</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">posterior1</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(21.78849107458653, 12.000000007076508, 10.000000000000375)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># Now we can generate a sample of 1000 values from the posterior</span>

<span class="n">rates</span> <span class="o">=</span> <span class="n">posterior2</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10.124528115288987
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># And we can generate a sequence of 8 weeks for each value</span>

<span class="n">order_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">order_array</span><span class="p">[:</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 3,  7,  8,  5,  8,  2, 10, 10],
       [10,  6,  8,  6, 13, 12, 12,  9],
       [ 9,  5,  3,  7,  3,  2,  6,  9],
       [12, 12,  7, 10,  6, 10, 17,  5],
       [15, 22, 16,  9, 15,  5, 11, 11]])
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># Here are the expected profits for each possible order</span>

<span class="n">printed_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">110</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">compute_expected_profits</span><span class="p">(</span><span class="n">printed</span><span class="p">,</span> <span class="n">order_array</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">printed</span> <span class="ow">in</span> <span class="n">printed_array</span><span class="p">]</span>
<span class="n">expected_profits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">printed_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># And here&#39;s what they look like.</span>

<span class="n">expected_profits</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Number of books printed&#39;</span><span class="p">,</span>
         <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Expected profit ($)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/chap09_173_0.png" src="_images/chap09_173_0.png" />
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solution</span>

<span class="c1"># The optimal order is 100 books, which is a little surprising.</span>

<span class="c1"># If we know for sure that the order rate is 10, the optimal</span>
<span class="c1"># order is 78.</span>

<span class="c1"># If we think the average order rate is 10, but we are unsure</span>
<span class="c1"># about it, the optimal order is 100.  Our uncertainty about</span>
<span class="c1"># the rate implies that higher values are possible, and we are</span>
<span class="c1"># better off ordering more books (and taking advantage of the</span>
<span class="c1"># volume discount), even at the risk of leaving books unsold.</span>

<span class="n">expected_profits</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="chap08.html" title="previous page">Poisson Processes</a>
    <a class='right-next' id="next-link" href="chap10.html" title="next page">Testing</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Allen B. Downey<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>